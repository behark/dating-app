# OWASP ZAP Automation Configuration
# https://www.zaproxy.org/docs/automate/automation-framework/

env:
  contexts:
    - name: "Dating App"
      urls:
        - "http://localhost:3001"
        - "http://localhost:19006"
      includePaths:
        - "http://localhost:3001/api/.*"
        - "http://localhost:19006/.*"
      excludePaths:
        - ".*\\.js$"
        - ".*\\.css$"
        - ".*\\.png$"
        - ".*\\.jpg$"
        - ".*\\.gif$"
        - ".*\\.ico$"
        - ".*\\.woff2?$"
      authentication:
        method: "script"
        parameters:
          script: "auth-script.js"
          scriptEngine: "ECMAScript : Oracle Nashorn"
        verification:
          method: "response"
          loggedInRegex: "\"success\":\\s*true"
          loggedOutRegex: "\"error\":\\s*\"Unauthorized\""
      sessionManagement:
        method: "cookie"
        parameters: {}
      users:
        - name: "test-user"
          credentials:
            username: "test@example.com"
            password: "TestPassword123!"

jobs:
  # Passive scanning - safe, non-intrusive
  - type: passiveScan-config
    parameters:
      maxAlertsPerRule: 10
      scanOnlyInScope: true
      maxBodySizeInBytesToScan: 10000

  # Spider configuration
  - type: spider
    parameters:
      context: "Dating App"
      user: "test-user"
      url: "http://localhost:3001/api"
      maxDuration: 5
      maxDepth: 5
      maxChildren: 10

  # Ajax Spider for SPA
  - type: spiderAjax
    parameters:
      context: "Dating App"
      url: "http://localhost:19006"
      maxDuration: 10
      maxCrawlDepth: 5
      numberOfBrowsers: 2

  # Active scanning - intrusive tests
  - type: activeScan
    parameters:
      context: "Dating App"
      user: "test-user"
      policy: "API-Scan"
      maxRuleDurationInMins: 5
      maxScanDurationInMins: 30

  # Generate reports
  - type: report
    parameters:
      template: "traditional-html"
      reportDir: "/reports"
      reportFile: "zap-report"
    risks:
      - high
      - medium
      - low
      - info

  - type: report
    parameters:
      template: "traditional-json"
      reportDir: "/reports"
      reportFile: "zap-report"

# Alert filters - customize which alerts to report
alertFilters:
  - ruleId: 10021  # X-Content-Type-Options
    newRisk: "Info"
    context: "Dating App"
    
  - ruleId: 10038  # Content Security Policy
    newRisk: "Low"
    context: "Dating App"
